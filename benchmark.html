<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuxWind Performance Benchmark</title>
    <script src="src/dux-wind.js"></script>
    <style>
        body { font-family: system-ui; margin: 2rem; }
        .benchmark { border: 1px solid #ccc; padding: 1rem; margin: 1rem 0; }
        .results { background: #f5f5f5; padding: 0.5rem; font-family: monospace; }
    </style>
</head>
<body>
    <h1>DuxWind vs Tailwind Performance Comparison</h1>
    
    <div class="benchmark">
        <h3>Test 1: Generate 100 unique classes</h3>
        <button onclick="benchmarkGeneration()">Run Benchmark</button>
        <div id="generation-results" class="results"></div>
    </div>

    <div class="benchmark">
        <h3>Test 2: Process 1000 DOM elements</h3>
        <button onclick="benchmarkDOMProcessing()">Run Benchmark</button>
        <div id="dom-results" class="results"></div>
    </div>

    <div class="benchmark">
        <h3>Test 3: Memory usage comparison</h3>
        <button onclick="benchmarkMemory()">Run Benchmark</button>
        <div id="memory-results" class="results"></div>
    </div>

    <script>
        DuxWind.resetCss();
        DuxWind.loadDefaultConfig();
        DuxWind.init({ debug: false });

        function benchmarkGeneration() {
            const classes = [
                'p-1', 'p-2', 'p-4', 'p-8', 'p-16',
                'm-1', 'm-2', 'm-4', 'm-8', 'm-16',
                'bg-red-500', 'bg-blue-500', 'bg-green-500',
                'text-xs', 'text-sm', 'text-lg', 'text-xl',
                'flex', 'grid', 'hidden', 'block',
                'justify-center', 'items-center',
                'rounded', 'rounded-lg', 'rounded-full',
                'border', 'border-2', 'border-4',
                'shadow', 'shadow-lg', 'shadow-xl'
            ];
            
            // Extend to 100 unique classes
            for (let i = classes.length; i < 100; i++) {
                classes.push(`w-${i}`, `h-${i}`, `text-${i}px`);
            }

            const startTime = performance.now();
            
            classes.forEach(className => {
                DuxWind.loadClass(className);
            });
            
            const endTime = performance.now();
            const duration = (endTime - startTime).toFixed(2);
            
            document.getElementById('generation-results').innerHTML = `
                Classes processed: ${classes.length}
                Time taken: ${duration}ms
                Average per class: ${(duration / classes.length).toFixed(3)}ms
                
                Comparison:
                - DuxWind: ${duration}ms (generated on-demand)
                - Tailwind: ~50-200ms (initial CSS download + parse)
                - Winner: ${duration < 50 ? 'DuxWind' : 'Tailwind'} for this test
            `;
        }

        function benchmarkDOMProcessing() {
            const container = document.createElement('div');
            document.body.appendChild(container);
            
            // Create 1000 elements with various classes
            const classOptions = ['p-4', 'bg-blue-100', 'text-center', 'rounded', 'border', 'shadow'];
            
            const startTime = performance.now();
            
            for (let i = 0; i < 1000; i++) {
                const div = document.createElement('div');
                const randomClasses = classOptions
                    .filter(() => Math.random() > 0.5)
                    .join(' ');
                div.className = randomClasses;
                div.textContent = `Element ${i}`;
                container.appendChild(div);
            }
            
            // Process all elements (simulates DuxWind's DOM observation)
            const elements = container.querySelectorAll('[class]');
            elements.forEach(el => {
                el.className.split(/\s+/).forEach(cls => {
                    if (cls) DuxWind.loadClass(cls);
                });
            });
            
            const endTime = performance.now();
            const duration = (endTime - startTime).toFixed(2);
            
            document.getElementById('dom-results').innerHTML = `
                Elements processed: 1000
                Time taken: ${duration}ms
                Average per element: ${(duration / 1000).toFixed(3)}ms
                
                Comparison:
                - DuxWind: ${duration}ms (generate + apply)
                - Tailwind: ~5-20ms (just apply existing CSS)
                - Winner: ${duration < 20 ? 'DuxWind' : 'Tailwind'} for this test
            `;
            
            // Cleanup
            container.remove();
        }

        function benchmarkMemory() {
            if (!performance.memory) {
                document.getElementById('memory-results').innerHTML = 
                    'Memory API not available in this browser';
                return;
            }

            const before = performance.memory.usedJSHeapSize;
            
            // Generate lots of classes to test memory usage
            for (let i = 0; i < 500; i++) {
                DuxWind.loadClass(`test-class-${i}`);
                DuxWind.loadClass(`bg-color-${i}`);
                DuxWind.loadClass(`p-${i % 20}`);
            }
            
            const after = performance.memory.usedJSHeapSize;
            const memoryUsed = ((after - before) / 1024).toFixed(2);
            
            document.getElementById('memory-results').innerHTML = `
                Memory used by DuxWind: ${memoryUsed}KB
                
                Comparison:
                - DuxWind: ${memoryUsed}KB (cached classes + generated CSS)
                - Tailwind (purged): ~5-15KB (full CSS file)
                - Tailwind (full): ~3500KB (full CSS file)
                
                Winner: ${memoryUsed < 100 ? 'DuxWind' : 'Tailwind (purged)'} for memory efficiency
            `;
        }

        // Auto-run a quick demo
        setTimeout(() => {
            document.getElementById('generation-results').innerHTML = `
                Click "Run Benchmark" to test DuxWind performance!
                
                Expected results:
                - Small projects: DuxWind wins (faster initial load)
                - Large projects: Depends on caching strategy
                - Dynamic content: DuxWind wins (no unused CSS)
            `;
        }, 100);
    </script>
</body>
</html>